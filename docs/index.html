<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="generator" content="Crystal Docs 1.3.0">
<meta name="crystal_docs.project_version" content="q9f/ethereum-dev">
<meta name="crystal_docs.project_name" content="secp256k1">



<link href="css/style.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="js/doc.js"></script>

  <meta name="repository-name" content="secp256k1">
  <title>secp256k1 q9f/ethereum-dev</title>
  <script type="text/javascript">
  CrystalDocs.base_path = "";
  </script>
</head>
<body>

<svg class="hidden">
  <symbol id="octicon-link" viewBox="0 0 16 16">
    <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
  </symbol>
</svg>
<div class="sidebar">
  <div class="sidebar-header">
    <div class="search-box">
      <input type="search" class="search-input" placeholder="Search..." spellcheck="false" aria-label="Search">
    </div>

    <div class="project-summary">
      <h1 class="project-name">
        <a href="index.html">
          secp256k1
        </a>
      </h1>

      <span class="project-version">
        q9f/ethereum-dev
      </span>
    </div>
  </div>

  <div class="search-results hidden">
    <ul class="search-list"></ul>
  </div>

  <div class="types-list">
    <ul>
  
  <li class="parent " data-id="secp256k1/Bitcoin" data-name="bitcoin">
      <a href="Bitcoin.html">Bitcoin</a>
      
        <ul>
  
  <li class=" " data-id="secp256k1/Bitcoin/Account" data-name="bitcoin::account">
      <a href="Bitcoin/Account.html">Account</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class="parent " data-id="secp256k1/Ethereum" data-name="ethereum">
      <a href="Ethereum.html">Ethereum</a>
      
        <ul>
  
  <li class=" " data-id="secp256k1/Ethereum/Account" data-name="ethereum::account">
      <a href="Ethereum/Account.html">Account</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class="parent " data-id="secp256k1/Secp256k1" data-name="secp256k1">
      <a href="Secp256k1.html">Secp256k1</a>
      
        <ul>
  
  <li class=" " data-id="secp256k1/Secp256k1/Context" data-name="secp256k1::context">
      <a href="Secp256k1/Context.html">Context</a>
      
    </li>
  
  <li class=" " data-id="secp256k1/Secp256k1/Curve" data-name="secp256k1::curve">
      <a href="Secp256k1/Curve.html">Curve</a>
      
    </li>
  
  <li class=" " data-id="secp256k1/Secp256k1/Key" data-name="secp256k1::key">
      <a href="Secp256k1/Key.html">Key</a>
      
    </li>
  
  <li class=" " data-id="secp256k1/Secp256k1/Num" data-name="secp256k1::num">
      <a href="Secp256k1/Num.html">Num</a>
      
    </li>
  
  <li class=" " data-id="secp256k1/Secp256k1/Point" data-name="secp256k1::point">
      <a href="Secp256k1/Point.html">Point</a>
      
    </li>
  
  <li class=" " data-id="secp256k1/Secp256k1/Signature" data-name="secp256k1::signature">
      <a href="Secp256k1/Signature.html">Signature</a>
      
    </li>
  
  <li class=" " data-id="secp256k1/Secp256k1/Util" data-name="secp256k1::util">
      <a href="Secp256k1/Util.html">Util</a>
      
    </li>
  
</ul>

      
    </li>
  
</ul>

  </div>
</div>


<div class="main-content">
<h1><a id="secp256k1.cr" class="anchor" href="#secp256k1.cr">  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>secp256k1.cr</h1>
<p><a href="https://github.com/q9f/secp256k1.cr/actions"><img src="https://img.shields.io/github/workflow/status/q9f/secp256k1.cr/Nightly" alt="Build Status" /></a>
<a href="https://codecov.io/gh/q9f/secp256k1.cr"><img src="https://codecov.io/gh/q9f/secp256k1.cr/branch/main/graph/badge.svg?token=ngxRs9HdJA" alt="Code Coverage" /></a>
<a href="https://q9f.github.io/secp256k1.cr/"><img src="https://img.shields.io/badge/docs-html-black" alt="Documentation" /></a>
<a href="https://github.com/q9f/secp256k1.cr/releases/latest"><img src="https://img.shields.io/github/v/release/q9f/secp256k1.cr?include_prereleases&amp;color=black" alt="Release" /></a>
<a href="https://github.com/q9f/secp256k1.cr/search?l=crystal"><img src="https://img.shields.io/github/languages/top/q9f/secp256k1.cr?color=black" alt="Language" /></a>
<a href="LICENSE"><img src="https://img.shields.io/github/license/q9f/secp256k1.cr.svg?color=black" alt="License" /></a></p>
<p>A library implementing the <code><a href="Secp256k1.html">Secp256k1</a></code> elliptic curve natively in pure Crystal.
<code><a href="Secp256k1.html">Secp256k1</a></code> is the elliptic curve used in the public-private-key cryptography required by <code><a href="Bitcoin.html">Bitcoin</a></code>, <code><a href="Ethereum.html">Ethereum</a></code>, and <code>Polkadot</code>.</p>
<p>This library allows for:</p>
<ul>
<li>providing a <code><a href="Secp256k1.html">Secp256k1</a></code> cryptographic context, see <code><a href="Secp256k1/Context.html">Secp256k1::Context</a></code></li>
<li>managing <code><a href="Secp256k1.html">Secp256k1</a></code> signatures and verification, see <code><a href="Secp256k1/Signature.html">Secp256k1::Signature</a></code></li>
<li>managing private-public keypairs, see <code><a href="Secp256k1/Key.html">Secp256k1::Key</a></code></li>
<li>generating public keys, see <code><a href="Secp256k1/Point.html">Secp256k1::Point</a></code></li>
<li>generating private keys, see <code><a href="Secp256k1/Num.html">Secp256k1::Num</a></code></li>
</ul>
<h1><a id="installation" class="anchor" href="#installation">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Installation</h1>
<p>Add the <code><a href="Secp256k1.html">Secp256k1</a></code> library to your <code>shard.yml</code></p>
<pre><code class="language-yaml">dependencies:
  secp256k1:
    github: q9f/secp256k1.cr
    version: &quot;~&gt; 0.5&quot;</code></pre>
<h1><a id="usage" class="anchor" href="#usage">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Usage</h1>
<p>Import and expose the <code><a href="Secp256k1.html">Secp256k1</a></code> module.</p>
<pre><code class="language-crystal"><span class="k">require</span> <span class="s">&quot;secp256k1&quot;</span></code></pre>
<p>This library exposes the following modules and classes (in logical order):</p>
<ul>
<li><code><a href="Secp256k1.html">Secp256k1</a></code>: necessary constants and data structures, including:
<ul>
<li><code><a href="Secp256k1/Num.html">Secp256k1::Num</a></code>: for managing big numerics (private keys)</li>
<li><code><a href="Secp256k1/Point.html">Secp256k1::Point</a></code>: for handling of elliptic curve points (public keys)</li>
<li><code><a href="Secp256k1/Key.html">Secp256k1::Key</a></code>: for managing private-public keypairs (accounts)</li>
<li><code><a href="Secp256k1/Signature.html">Secp256k1::Signature</a></code>: for handling ECDSA signatures (r, s, v)</li>
</ul>
</li>
<li><code><a href="Secp256k1/Context.html">Secp256k1::Context</a></code>: providing a cryptographic context for signing and verification</li>
<li><code><a href="Secp256k1/Curve.html">Secp256k1::Curve</a></code>: the entire core mathematics behind the elliptic curve cryptography</li>
<li><code><a href="Secp256k1/Util.html">Secp256k1::Util</a></code>: binding of various hashing algorithms for convenience</li>
</ul>
<p>Basic usage:</p>
<pre><code class="language-crystal"><span class="c"># generates a new, random keypair</span>
key <span class="o">=</span> <span class="t">Secp256k1</span><span class="t">::</span><span class="t">Key</span>.<span class="k">new</span>
<span class="c"># =&gt; #&lt;Secp256k1::Key:0x7fad7235aee0</span>
<span class="c">#          @private_key=#&lt;Secp256k1::Num:0x7fad7235d300</span>
<span class="c">#              @hex=&quot;3ccf84820c20d5e8c536ba84c52ba410375b29b1812b5f7e722445c969a0fb30&quot;,</span>
<span class="c">#              @dec=27505422793993207218034260454067205887515304192802142316084292370834437241648,</span>
<span class="c">#              @bin=Bytes[60, 207, 132, 130, 12, 32, 213, 232, 197, 54, 186, 132, 197, 43, 164, 16, 55, 91, 41, 177, 129, 43, 95, 126, 114, 36, 69, 201, 105, 160, 251, 48]&gt;,</span>
<span class="c">#          @public_key=#&lt;Secp256k1::Point:0x7fad7235ad20</span>
<span class="c">#              @x=#&lt;Secp256k1::Num:0x7fad69294ec0</span>
<span class="c">#                  @hex=&quot;cd4a8712ee6efc15b5abe37c0dbfa979d89c427d3fe24b076008decefe94dba2&quot;,</span>
<span class="c">#                  @dec=92855812888509048668847240903552964511053624688683992093822247249407942908834,</span>
<span class="c">#                  @bin=Bytes[205, 74, 135, 18, 238, 110, 252, 21, 181, 171, 227, 124, 13, 191, 169, 121, 216, 156, 66, 125, 63, 226, 75, 7, 96, 8, 222, 206, 254, 148, 219, 162]&gt;,</span>
<span class="c">#              @y=#&lt;Secp256k1::Num:0x7fad69294e80</span>
<span class="c">#                  @hex=&quot;81363d298e4a40ebcb13f1afa85a0b94b967f243ee59a59010cb5deaf0d7b66c&quot;,</span>
<span class="c">#                  @dec=58444189335609256006902338825877424261513225250255958585656342678587884156524,</span>
<span class="c">#                  @bin=Bytes[129, 54, 61, 41, 142, 74, 64, 235, 203, 19, 241, 175, 168, 90, 11, 148, 185, 103, 242, 67, 238, 89, 165, 144, 16, 203, 93, 234, 240, 215, 182, 108]&gt;&gt;&gt;</span>

<span class="c"># gets the private key</span>
key.private_hex
<span class="c"># =&gt; &quot;3ccf84820c20d5e8c536ba84c52ba410375b29b1812b5f7e722445c969a0fb30&quot;</span>

<span class="c"># gets the compressed public key with prefix</span>
key.public_hex_compressed
<span class="c"># =&gt; &quot;02cd4a8712ee6efc15b5abe37c0dbfa979d89c427d3fe24b076008decefe94dba2&quot;</span></code></pre>
<p>Signature generation and verification:</p>
<pre><code class="language-crystal"><span class="c"># sign a message with a private key</span>
ctx <span class="o">=</span> <span class="t">Secp256k1</span><span class="t">::</span><span class="t">Context</span>.<span class="k">new</span>
priv <span class="o">=</span> <span class="t">Secp256k1</span><span class="t">::</span><span class="t">Num</span>.<span class="k">new</span> <span class="s">&quot;1f0c122d41ff536b19bfd83537c0dfc290e45cd3c375a43237c8b8fff7ac8af7&quot;</span>
key <span class="o">=</span> <span class="t">Secp256k1</span><span class="t">::</span><span class="t">Key</span>.<span class="k">new</span> priv
hash <span class="o">=</span> <span class="t">Secp256k1</span><span class="t">::</span><span class="t">Util</span>.sha256 <span class="s">&quot;Henlo, Wordl&quot;</span>
sig <span class="o">=</span> ctx.sign key, hash
<span class="c"># =&gt; #&lt;Secp256k1::Signature:0x7f5332e1d9c0</span>
<span class="c">#          @r=#&lt;Secp256k1::Num:0x7f5332decac0</span>
<span class="c">#              @hex=&quot;c4079db44240b7afe94985c69fc89602e33629fd9b8623d711c30ce6378b33df&quot;,</span>
<span class="c">#              @dec=88666774685717741514025410921892109286073075687452443491001272268566542627807,</span>
<span class="c">#              @bin=Bytes[196, 7, 157, 180, 66, 64, 183, 175, 233, 73, 133, 198, 159, 200, 150, 2, 227, 54, 41, 253, 155, 134, 35, 215, 17, 195, 12, 230, 55, 139, 51, 223]&gt;,</span>
<span class="c">#          @s=#&lt;Secp256k1::Num:0x7f5332deca80</span>
<span class="c">#              @hex=&quot;6842c1b63c94bdb8e4f5ae88fb65f7a98b77b197c8323004fb47ef57fab29053&quot;,</span>
<span class="c">#              @dec=47158485109070227797431103290229472044663017260590156038384319099500326195283,</span>
<span class="c">#              @bin=Bytes[104, 66, 193, 182, 60, 148, 189, 184, 228, 245, 174, 136, 251, 101, 247, 169, 139, 119, 177, 151, 200, 50, 48, 4, 251, 71, 239, 87, 250, 178, 144, 83]&gt;,</span>
<span class="c">#          @v=#&lt;Secp256k1::Num:0x7f5332deca40</span>
<span class="c">#              @hex=&quot;00&quot;,</span>
<span class="c">#              @dec=0,</span>
<span class="c">#              @bin=Bytes[0]&gt;&gt;</span>

<span class="c"># verify a signature with a public key</span>
r <span class="o">=</span> <span class="t">Secp256k1</span><span class="t">::</span><span class="t">Num</span>.<span class="k">new</span> <span class="s">&quot;c4079db44240b7afe94985c69fc89602e33629fd9b8623d711c30ce6378b33df&quot;</span>
s <span class="o">=</span> <span class="t">Secp256k1</span><span class="t">::</span><span class="t">Num</span>.<span class="k">new</span> <span class="s">&quot;6842c1b63c94bdb8e4f5ae88fb65f7a98b77b197c8323004fb47ef57fab29053&quot;</span>
v <span class="o">=</span> <span class="t">Secp256k1</span><span class="t">::</span><span class="t">Num</span>.<span class="k">new</span> <span class="s">&quot;00&quot;</span>
sig <span class="o">=</span> <span class="t">Secp256k1</span><span class="t">::</span><span class="t">Signature</span>.<span class="k">new</span> r, s, v
hash <span class="o">=</span> <span class="t">Secp256k1</span><span class="t">::</span><span class="t">Util</span>.sha256 <span class="s">&quot;Henlo, Wordl&quot;</span>
publ <span class="o">=</span> <span class="t">Secp256k1</span><span class="t">::</span><span class="t">Point</span>.<span class="k">new</span> <span class="s">&quot;0416008a369439f1a8a75cf974860bed5b10180518d6b1dd3ac847f423fd375d6aa29474394f0cd79d2ea543507d069e97339284f01bdbfd27392daec0ec553816&quot;</span>
ctx.verify sig, hash, publ
<span class="c"># =&gt; true</span></code></pre>
<p>There are example scripts for generating <code><a href="Bitcoin.html">Bitcoin</a></code> and <code><a href="Ethereum.html">Ethereum</a></code> accounts in <code>src/bitcoin.cr</code> and <code>src/ethereum.cr</code>.</p>
<h1><a id="documentation" class="anchor" href="#documentation">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Documentation</h1>
<p>The full library documentation can be found here: <a href="https://q9f.github.io/secp256k1.cr/">q9f.github.io/secp256k1.cr</a></p>
<p>Generate a local copy with:</p>
<pre><code class="language-shell">crystal docs</code></pre>
<h1><a id="testing" class="anchor" href="#testing">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Testing</h1>
<p>The library is entirely specified through tests in <code>./spec</code>; run:</p>
<pre><code class="language-shell">crystal spec --verbose</code></pre>
<h1><a id="understand" class="anchor" href="#understand">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Understand</h1>
<p>Private keys are just scalars (<code><a href="Secp256k1/Num.html">Secp256k1::Num</a></code>) and public keys are points (<code><a href="Secp256k1/Point.html">Secp256k1::Point</a></code>) with <code>x</code> and <code>y</code> coordinates.</p>
<p>Bitcoin public keys can be uncompressed <code>p|x|y</code> or compressed <code>p|x</code>. both come with a prefix <code>p</code> which is useless for uncompressed keys but necessary for compressed keys to recover the <code>y</code> coordinate on the <code><a href="Secp256k1.html">Secp256k1</a></code> elliptic curve field.</p>
<p>Ethereum public keys are uncompressed <code>x|y</code> without any prefix. The last 20 bytes slice of the <code>y</code> coordinate is actually used as address without any checksum. A checksum was later added in EIP-55 using a <code>keccak256</code> hash and indicating character capitalization.</p>
<p>Neither Bitcoin nor Ethereum allow for recovering public keys from an address unless there exists a transaction with a valid signature on the blockchain.</p>
<h1><a id="known-issues" class="anchor" href="#known-issues">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Known issues</h1>
<p><em>Note: this library should not be used in production without proper auditing. It should be considered slow and insecure.</em></p>
<ul>
<li>This library is not constant time and might be subject to side-channel attacks. (<a href="https://github.com/q9f/secp256k1.cr/issues/4">#4</a>)</li>
<li>This library does unnecessary big-integer math and should someday rather correctly implement the <code><a href="Secp256k1.html">Secp256k1</a></code> prime field (<a href="https://github.com/q9f/secp256k1.cr/issues/5">#5</a>)</li>
<li>This library is slow in recovering signatures. Future versions should respect the recovery ID to quickly identify the correct public key from a signature.</li>
</ul>
<p>Found any other issue? Report it: <a href="https://github.com/q9f/secp256k1.cr/issues">github.com/q9f/secp256k1.cr/issues</a></p>
<h1><a id="contribute" class="anchor" href="#contribute">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Contribute</h1>
<p>Create a pull request, and make sure tests and linter pass.</p>
<p>This pure crystal implementation is based on the python implementation <a href="https://github.com/wobine/blackboard101">wobine/blackboard101</a> which is also used as reference to write tests against. It's a complete rewrite of the abandoned <a href="https://github.com/packetzero/bitcoinutils">packetzero/bitcoinutils</a> for educational purposes.</p>
<p>Honerable mention for the <a href="https://en.bitcoin.it/wiki/Main_Page">bitcoin wiki</a> and the <a href="https://ethereum.stackexchange.com/">ethereum stackexchange</a> for providing so many in-depth resources that supported this project in reimplementing everything.</p>
<p>License: Apache License v2.0</p>
<p>Contributors: <a href="https://github.com/q9f/"><strong>@q9f</strong></a>, <a href="https://github.com/cserb">@cserb</a>, <a href="https://github.com/MrSorcus">MrSorcus</a></p>
</div>
</body>
</html>
